const ORIGINAL_IMAGE_ID="original-img",CANVAS_ID="canvas",FORM_ID="image-form",DOWNLOAD_BUTTON_ID="download-button",IMAGE_INPUT_ID="image-input",IMAGE_LABEL_ID="image-label";window.onload=(()=>{Listeners.inputFileChange("image-input","image-label"),Listeners.formSubmit(FORM_ID),Listeners.downloadButton("download-button","original-img","canvas")});const Listeners={formSubmit:e=>{document.getElementById(e).addEventListener("submit",e=>{e.preventDefault(),ImageProcessor.getImageDataFromInputFile("#image-form input[type=file]").then(e=>ImageProcessor.getImageObject(e)).then(e=>ImageProcessor.createPreviewAndCanvas(e,"original-img","canvas",ImageProcessor.drawImageOnCanvas))})},downloadButton:(e,t,n)=>{const a=document.getElementById(e),o=document.getElementById(n);a.addEventListener("click",e=>{document.getElementById(t)||e.preventDefault();const n=o.toDataURL("image/png").replace("image/png","image/octet-stream");a.setAttribute("href",n)})},inputFileChange:(e,t)=>{document.getElementById(e).addEventListener("change",e=>{document.getElementById(t).innerText=e.target.files[0].name})}},ImageProcessor={getImageDataFromInputFile:e=>{const t=document.querySelector(e).files[0];return new Promise(e=>e(t))},getImageObject:e=>{const t=new FileReader,n=new Image;return t.readAsDataURL(e),t.onload=(e=>{n.src=e.target.result}),new Promise(e=>e(n))},createPreviewAndCanvas:(e,t,n,a)=>{const o=document.createElement("img");return e.onload=(()=>{const i=document.getElementById(t);i&&i.remove(),o.src=e.src,o.width=e.width,o.height=e.height,o.id=t,o.className="hidden",document.querySelector(".preview-original-image").appendChild(o),a(n,t)}),new Promise(e=>e())},drawImageOnCanvas:(e,t)=>{const n=document.getElementById(e),a=document.getElementById(t),o=n.getContext("2d");n.height=a.height,n.width=a.width,o.drawImage(a,0,0);const i=o.getImageData(0,0,a.width,a.height),m=i.data,r=0,g=0,d=0,s=0;for(let e=0,t=m.length;e<t;e+=4){let t=m[e],n=m[e+1],a=m[e+2];255===t&&255===n&&255===a&&(m[e]=r,m[e+1]=g,m[e+2]=d,m[e+3]=s)}o.putImageData(i,0,0)}};